<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงููููุน ุงูุฅููุชุฑููู - ุชุตููู ุนุตุฑู ูููุซูู</title>
    
    <style>
        /* =====================================
         * ุงูุฃููุงู ูุงูุชุตููู ุงูุญุฏูุซ
         * ===================================== */
        :root {
            /* ุฏุฑุฌุงุช ุฃููุงู ุจุญุฑูุฉ ุนุตุฑูุฉ */
            --color-primary: #1E90FF;    /* DodgerBlue - ุฃุณุงุณู */
            --color-secondary: #00BFFF;  /* DeepSkyBlue - ุซุงููู */
            --color-background: #F8F8FF; /* GhostWhite - ุฎูููุฉ ูุงุชุญุฉ */
            --color-card: #FFFFFF;       /* White - ุฎูููุฉ ุงูุจุทุงูุงุช/ุงูุฃูุณุงู */
            --color-text: #333333;       /* ููู ุงููุต ุงูุฃุณุงุณู */
            --color-success: #28a745;
            --color-danger: #dc3545;
        }

        /* ุงูุชุตููู ุงูุฃุณุงุณู ููุฌุณู */
        body {
            font-family: 'Tahoma', sans-serif;
            margin: 0;
            padding: 0;
            direction: rtl; 
            text-align: right;
            font-size: 14px; 
            background-color: var(--color-background);
            color: var(--color-text);
        }

        /* ุชูุณูู ุงูุญููู ูุงูุฃุฒุฑุงุฑ */
        input:not([type="checkbox"]), button {
            padding: 12px;
            font-size: 1em;
            border-radius: 8px;
            transition: all 0.3s;
            border: 1px solid #ccc;
            margin-bottom: 15px;
            width: 95%;
            box-sizing: border-box;
        }
        button {
            border: none;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        /* =====================================
         * 1. ุตูุญุฉ ุงูุฒูุงุฑ (ุงููุงุฌูุฉ ุงูุฑุฆูุณูุฉ)
         * ===================================== */
        #visitor-page {
            background-color: var(--color-secondary);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .search-container {
            padding: 30px; 
            background: var(--color-card);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 90%; 
            max-width: 450px;
        }
        #product-number {
            border: 2px solid var(--color-primary);
            text-align: center;
            font-size: 1.2em;
        }
        #search-button {
            background-color: var(--color-primary);
            color: white;
            width: 100%;
        }

        /* =====================================
         * 2. ููุญุฉ ุงูุชุญูู (ุงูููุงุฆู ุงูุนูููุฉ)
         * ===================================== */

        #admin-page {
            display: none;
            min-height: 100vh;
        }

        /* ุดุฑูุท ุงูุชููู ุงูุนููู */
        .top-nav {
            background-color: var(--color-primary);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 0;
            width: 100%;
        }
        .nav-list {
            display: flex;
            justify-content: space-around;
            list-style: none;
            padding: 0;
            margin: 0;
            flex-wrap: wrap; 
        }
        .nav-list li {
            flex-grow: 1;
        }
        .nav-button {
            background: none;
            color: white;
            padding: 15px 10px;
            border-radius: 0;
            font-size: 1em;
            width: 100%;
            display: block;
            text-align: center;
            margin: 0;
        }
        .nav-button.active {
            background-color: var(--color-secondary);
            color: white;
        }
        .nav-button:hover:not(.active) {
            background-color: #3b90f7;
        }

        .content {
            padding: 20px; 
        }

        .section {
            display: none;
            background: var(--color-card);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-top: 15px;
        }
        .section.active {
            display: block;
        }

        /* ุงูุฌุฏุงูู (ุงูุฅุญุตุงุฆูุงุช) */
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .stats-table th, .stats-table td {
            border: 1px solid #eee;
            padding: 12px;
            text-align: right;
        }
        .stats-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        
        /* ุชูุณูู ุงูููุชุฌุงุช ูู ูุงุฆูุฉ ุงูุชุนุฏูู (ูุชุฌุงูุจ) */
        #products-list-container li {
            list-style: none;
            border-bottom: 1px solid #eee;
            padding: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        #products-list-container li > div:first-child {
            flex-basis: 100%; /* ุชุฃูุฏ ูู ุดุบู ุงูุนุฑุถ ูุงููุงู ุนูู ุงูุฌูุงู */
            margin-bottom: 10px;
        }
        #products-list-container li > div:last-child {
             flex-basis: 100%;
             text-align: left;
        }
        #products-list-container li button {
            width: auto;
            margin: 5px 5px 0 0;
            font-size: 0.8em;
            padding: 5px 8px;
        }

        /* Mobile specific adjustments (3 ุฃุฒุฑุงุฑ ูู ุงูุตู) */
        @media (max-width: 600px) {
            .nav-list li {
                width: 33.33%; 
            }
            .nav-button {
                padding: 10px 5px;
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>

    <div id="visitor-page">
        <div class="search-container">
            <h1>ุงุจุญุซ ุนู ุงูููุชุฌ ุจุฑูู</h1>
            <p style="color: var(--color-text); font-size: 1.1em;">ุฃุฏุฎู ุงูุฑูู ุงููุฎุตุต ููููุชุฌ ุฃุฏูุงู.</p>
            
            <input type="number" id="product-number" placeholder="ุถุน ุณุฑู ููุง" required>
            
            <button id="search-button">๐ ุชูุฌู ุฅูู ุงููููุน</button>

            <p style="margin-top: 20px;">
                <button id="go-to-admin" style="background: none; border: none; color: var(--color-primary); font-size: 0.9em; cursor: pointer;">ุตูุญุฉ ุงูุฅุฏุงุฑุฉ</button>
            </p>
        </div>
    </div>

    <div id="admin-page">
        
        <div id="login-overlay">
            <div style="background: white; padding: 40px; border-radius: 10px; text-align: center; box-shadow: 0 0 20px rgba(0,0,0,0.3);">
                <h3>๐ ุงูุฏุฎูู ุฅูู ููุญุฉ ุงูุชุญูู</h3>
                <input type="password" id="admin-password" placeholder="ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ" style="margin: 15px 0;">
                <button id="login-button" style="background-color: var(--color-success); color: white;">ุชุณุฌูู ุงูุฏุฎูู</button>
                <p id="login-message" style="color: var(--color-danger); margin-top: 10px;"></p>
                <button id="back-to-visitor" style="background-color: #f3f3f3; color: var(--color-text); margin-top: 15px;">ุงูุนูุฏุฉ ูุตูุญุฉ ุงูุฒูุงุฑ</button>
            </div>
        </div>

        <header class="top-nav">
            <nav>
                <ul class="nav-list" id="admin-nav-list" style="display: none;">
                    <li><button class="nav-button active" data-section="add-product-section">โ ุฅุถุงูุฉ ููุชุฌ</button></li>
                    <li><button class="nav-button" data-section="edit-delete-section">โ๏ธ ุชุนุฏูู / ุญุฐู</button></li>
                    <li><button class="nav-button" data-section="stats-section">๐ ุงูุฅุญุตุงุฆูุงุช</button></li>
                    <li><button class="nav-button" data-section="categories-section">๐ท๏ธ ุงูุชุตูููุงุช</button></li>
                    <li><button class="nav-button" data-section="dev-suggestions-section">๐ก ุชุทููุฑ</button></li>
                    <li><button class="nav-button" data-section="logout-section" id="btn-logout-nav" style="background-color: var(--color-danger);">ุฎุฑูุฌ</button></li>
                </ul>
            </nav>
        </header>

        <div class="content" id="admin-content" style="display: none;">

            <div id="add-product-section" class="section active">
                <h3>โ ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ</h3>
                <form class="add-product-form">
                    <label for="p-number" style="font-weight: bold;">ุฑูู ุงูููุชุฌ:</label>
                    <input type="number" id="p-number-admin" placeholder="ุฃุฏุฎู ุฑูู ูุฑูุฏ ููููุชุฌ" required autofocus><br>
                    
                    <label for="p-link" style="font-weight: bold;">ุฑุงุจุท ุงูููุชุฌ:</label>
                    <input type="url" id="p-link-admin" placeholder="ุงูุณุฎ ุงูุฑุงุจุท ุงููุงูู ููุง" required><br>
                    
                    <h4 style="margin-top: 20px;">ุชุตููู ุงูููุชุฌ:</h4>
                    <div class="checkbox-group" style="border: 1px solid #eee; padding: 10px; border-radius: 5px; margin-bottom: 20px;">
                        <label><input type="checkbox" name="category" value="aliexpress"> ุนูู ุฅูุณุจุฑุณ</label>
                        <label><input type="checkbox" name="category" value="amazon"> ุฃูุงุฒูู</label>
                        <label><input type="checkbox" name="category" value="other"> ุชุตููู ุขุฎุฑ</label>
                    </div>
                    
                    <button type="button" id="save-product-btn" style="background-color: var(--color-success); color: white; width: 100%;">ุญูุธ ุงูููุชุฌ ุงูุฌุฏูุฏ</button>
                    <p id="save-message" style="margin-top: 10px; font-weight: bold;"></p>
                </form>
            </div>

            <div id="edit-delete-section" class="section">
                <h3>โ๏ธ ุชุนุฏูู / ุญุฐู ููุชุฌ</h3>
                <div id="products-list-container"></div>
            </div>
            
            <div id="stats-section" class="section">
                <h3>๐ ุฅุญุตุงุฆูุงุช ูุชุญููู ุงูุจูุงูุงุช</h3>
                <p>ุชุญููู ูููุธู ูุชุตูููุงุช ููุชุฌุงุชู.</p>
                
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>ุงูุชุตููู</th>
                            <th>ุนุฏุฏ ุงูููุชุฌุงุช</th>
                            <th>ุงููุณุจุฉ ุงููุฆููุฉ ูู ุงูุฅุฌูุงูู</th>
                        </tr>
                    </thead>
                    <tbody id="stats-table-body"></tbody>
                    <tfoot>
                        <tr style="background-color: #f0f0f0;">
                            <th>ุงูุฅุฌูุงูู</th>
                            <th id="total-products-stat">0</th>
                            <th>100%</th>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <div id="categories-section" class="section">
                <h3>๐ท๏ธ ุชุตูููุงุช ุงูููุชุฌุงุช</h3>
                <p>ุงูุชุตูููุงุช ุงููุชุงุญุฉ ุญุงูููุง ูู: ุนูู ุฅูุณุจุฑุณุ ุฃูุงุฒููุ ู ุชุตููู ุขุฎุฑ.</p>
            </div>
            
            <div id="dev-suggestions-section" class="section">
                <h3>๐ก ููุชุฑุญุงุช ููุชุทููุฑ ูุงูุชุญุณูู</h3>
                <ul style="list-style-type: square; padding-right: 20px;">
                    <li>**ุงูุชุฎุฒูู ุงูุขูู:** ููู ุงูุจูุงูุงุช ุฅูู ูุงุนุฏุฉ ุจูุงูุงุช ุณุญุงุจูุฉ (ูุซู Firebase) ุจุฏูุงู ูู ูุชุตูุญ ุงูุฒุงุฆุฑ.</li>
                    <li>**ูุธููุฉ ุงูุชุนุฏูู:** ุชูุนูู ุฒุฑ "ุชุนุฏูู" ุงูููุฌูุฏ ููุณูุญ ุจุชุญุฏูุซ ุงูุฑุงุจุท ุฃู ุงูุฑูู.</li>
                    <li>**ุชุชุจุน ุงูููุฑุงุช:** ุฅุถุงูุฉ ุนุฏุงุฏ ููููุฑุงุช ุนูู ูู ุฑุงุจุท ูุชุญุฏูุฏ ุงูููุชุฌุงุช ุงูุฃูุซุฑ ุทูุจุงู.</li>
                </ul>
            </div>
            
            <div id="logout-section" class="section">
                <h3>ุชุณุฌูู ุงูุฎุฑูุฌ</h3>
                <p>ูุฅููุงุก ุฌูุณุฉ ุงูุฅุฏุงุฑุฉุ ุงููุฑ ุนูู ุฒุฑ "ุงูุฎุฑูุฌ".</p>
                <button id="btn-logout-content" style="background-color: var(--color-danger); color: white; width: 100%;">ุงูุฎุฑูุฌ ูุงูุนูุฏุฉ ูุตูุญุฉ ุงูุฒูุงุฑ</button>
            </div>

        </div>
    </div>

    <script>
        // ุงููุชุบูุฑุงุช ุงูุฃุณุงุณูุฉ
        const visitorPage = document.getElementById('visitor-page');
        const adminPage = document.getElementById('admin-page');
        const loginOverlay = document.getElementById('login-overlay');
        const adminNavList = document.getElementById('admin-nav-list'); // ุชู ุชุบููุฑ ุงูุงุณู
        
        const CORRECT_PASSWORD = '1421'; 

        // ุฏูุงู ุงููุณุงุนุฏุฉ ููุจูุงูุงุช
        const getCategoryName = (categoryValue) => {
            if (categoryValue === 'aliexpress') return 'ุนูู ุฅูุณุจุฑุณ';
            if (categoryValue === 'amazon') return 'ุฃูุงุฒูู';
            return 'ุฃุฎุฑู';
        };

        const getProducts = () => {
            const products = localStorage.getItem('products');
            return products ? JSON.parse(products) : {};
        };

        const saveProducts = (products) => {
            localStorage.setItem('products', JSON.stringify(products));
            updateStats();
        };

        //
        // ูุธููุฉ ุงูุฅุญุตุงุฆูุงุช (ุชุญููู ุจูุงูุงุช ููุญุณููู)
        //
        const updateStats = () => {
            const products = getProducts();
            const allProducts = Object.values(products);
            const total = allProducts.length;
            let counts = { 'aliexpress': 0, 'amazon': 0, 'other': 0 };

            allProducts.forEach(product => {
                if (product.categories) {
                    product.categories.forEach(cat => {
                        if (counts.hasOwnProperty(cat)) {
                            counts[cat]++;
                        }
                    });
                }
            });
            
            const statsBody = document.getElementById('stats-table-body');
            statsBody.innerHTML = '';

            const categories = ['aliexpress', 'amazon', 'other'];

            categories.forEach(cat => {
                const count = counts[cat];
                const percentage = total > 0 ? ((count / total) * 100).toFixed(1) : 0;
                
                const row = statsBody.insertRow();
                row.insertCell().textContent = getCategoryName(cat);
                row.insertCell().textContent = count;
                row.insertCell().textContent = `${percentage}%`;
            });
            
            document.getElementById('total-products-stat').textContent = total;
        };

        //
        // ูุธููุฉ ุนุฑุถ ูุญุฐู ุงูููุชุฌุงุช
        //
        const renderProductsList = () => {
            const products = getProducts();
            const container = document.getElementById('products-list-container');
            container.innerHTML = ''; 

            if (Object.keys(products).length === 0) {
                container.innerHTML = '<p style="color: gray;">ูุง ุชูุฌุฏ ููุชุฌุงุช ูุณุฌูุฉ ุจุนุฏ.</p>';
                return;
            }
            
            const listHTML = document.createElement('ul');
            
            Object.keys(products).forEach(num => {
                const product = products[num];
                const listItem = document.createElement('li');
                
                const categoryNames = product.categories.map(getCategoryName).join('ุ ');

                listItem.innerHTML = `
                    <div>
                        <span style="font-weight: bold; color: var(--color-primary);">ุฑูู: ${num}</span> | 
                        ุฑุงุจุท: <a href="${product.link}" target="_blank" title="${product.link}">ุงูุฑุงุจุท</a> 
                        <br>
                        <span style="font-size: 0.9em; color: #555;">ุงูุชุตููู: ${categoryNames || 'ูุง ููุฌุฏ'}</span>
                    </div>
                    <div>
                        <button style="background-color: #ffc107; color: var(--color-text);">ุชุนุฏูู</button>
                        <button onclick="deleteProduct('${num}')" style="background-color: var(--color-danger); color: white;">ุญุฐู</button>
                    </div>
                    `;
                listHTML.appendChild(listItem);
            });
            
            container.appendChild(listHTML);
        };

        window.deleteProduct = (num) => {
            if (confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงูููุชุฌ ุฑูู ${num}ุ`)) {
                const products = getProducts();
                delete products[num];
                saveProducts(products);
                renderProductsList(); 
            }
        };


        //
        // 3. ุฅุฏุงุฑุฉ ุงูุชููู ูุชุณุฌูู ุงูุฏุฎูู (ุชู ุชุตุญูุญ ุงูุฅุธูุงุฑ ููุง)
        //

        const showAdmin = () => {
            visitorPage.style.display = 'none';
            adminPage.style.display = 'block';
            adminNavList.style.display = 'flex'; // **ุงูุชุตุญูุญ: ุฅุธูุงุฑ ุงููุงุฆูุฉ ุงูุนูููุฉ**
            document.getElementById('admin-content').style.display = 'block';
            loginOverlay.style.display = 'none';
        };

        const showVisitor = () => {
            visitorPage.style.display = 'flex';
            adminPage.style.display = 'none';
            loginOverlay.style.display = 'none';
        };

        document.getElementById('go-to-admin').addEventListener('click', () => {
            if (sessionStorage.getItem('adminLoggedIn') === 'true') {
                showAdmin();
            } else {
                visitorPage.style.display = 'none';
                adminPage.style.display = 'block';
                loginOverlay.style.display = 'flex';
            }
        });

        document.getElementById('login-button').addEventListener('click', () => {
            const passwordInput = document.getElementById('admin-password');
            const loginMessage = document.getElementById('login-message');
            
            if (passwordInput.value === CORRECT_PASSWORD) { 
                sessionStorage.setItem('adminLoggedIn', 'true');
                showAdmin();
                loginMessage.textContent = '';
                updateStats();
                // ุชูุนูู ูุณู ุงูุฅุถุงูุฉ ุจุนุฏ ุงูุฏุฎูู
                document.getElementById('add-product-section').classList.add('active');
            } else {
                loginMessage.textContent = 'ูููุฉ ุงููุฑูุฑ ุฎุงุทุฆุฉ. ุญุงูู ูุฌุฏุฏุงู.';
                passwordInput.value = '';
            }
        });

        document.getElementById('back-to-visitor').addEventListener('click', showVisitor);
        
        // ุงูุฎุฑูุฌ
        const handleLogout = () => {
            sessionStorage.removeItem('adminLoggedIn');
            showVisitor();
        };

        document.getElementById('btn-logout-nav').addEventListener('click', handleLogout);
        document.getElementById('btn-logout-content').addEventListener('click', handleLogout);


        //
        // 4. ููุทู ุงูุชููู ุงูุฏุงุฎูู (ุงููุงุฆูุฉ ุงูุนูููุฉ)
        //

        const navButtons = document.querySelectorAll('.nav-button');
        const sections = document.querySelectorAll('.section');

        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                navButtons.forEach(btn => btn.classList.remove('active'));
                sections.forEach(sec => sec.classList.remove('active'));

                button.classList.add('active');
                const targetSectionId = button.getAttribute('data-section');
                
                if (targetSectionId !== 'logout-section') {
                    document.getElementById(targetSectionId).classList.add('active');
                }

                if (targetSectionId === 'edit-delete-section') {
                    renderProductsList();
                } else if (targetSectionId === 'stats-section') {
                    updateStats();
                }
            });
        });


        //
        // 5. ูุธููุฉ ุญูุธ ุงูููุชุฌ ุงูุฌุฏูุฏ
        //

        document.getElementById('save-product-btn').addEventListener('click', () => {
            const numInput = document.getElementById('p-number-admin');
            const linkInput = document.getElementById('p-link-admin');
            const saveMessage = document.getElementById('save-message');
            const categoryCheckboxes = document.querySelectorAll('.checkbox-group input[name="category"]:checked');
            
            const productNum = numInput.value.trim();
            const productLink = linkInput.value.trim();
            const categories = Array.from(categoryCheckboxes).map(cb => cb.value);

            if (!productNum || !productLink) {
                saveMessage.textContent = 'ุงูุฑุฌุงุก ุฅุฏุฎุงู ุฑูู ูุฑุงุจุท ุงูููุชุฌ.';
                saveMessage.style.color = 'var(--color-danger)';
                return;
            }

            const products = getProducts();
            
            if (products[productNum]) {
                saveMessage.textContent = 'โ๏ธ ูุฐุง ุงูุฑูู ููุฌูุฏ ุจุงููุนู.';
                saveMessage.style.color = '#ffc107';
                return;
            }

            products[productNum] = {
                link: productLink,
                categories: categories 
            };
            
            saveProducts(products);
            saveMessage.textContent = `โ ุชู ุญูุธ ุงูููุชุฌ ุฑูู ${productNum} ุจูุฌุงุญ!`;
            saveMessage.style.color = 'var(--color-success)';
            numInput.value = '';
            linkInput.value = '';
            categoryCheckboxes.forEach(cb => cb.checked = false); 
        });

        //
        // 6. ูุธููุฉ ุงูุจุญุซ ูู ุตูุญุฉ ุงูุฒูุงุฑ
        //

        document.getElementById('search-button').addEventListener('click', () => {
            const productNum = document.getElementById('product-number').value.trim();
            const products = getProducts();

            if (productNum) {
                const product = products[productNum];

                if (product && product.link) {
                    window.open(product.link, '_blank');
                } else {
                    alert('ุนุฐุฑุงูุ ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูููุชุฌ ุจุงูุฑูู: ' + productNum);
                }
            } else {
                alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุฑูู ุงูููุชุฌ.');
            }
        });

        updateStats(); 
    </script>
</body>
</html>